{
  "schemaVersion": "1.0.0",
  "module": {
    "name": "agenticsdr.core",
    "generatedAt": "2025-01-23T10:00:00Z",
    "lastUpdatedAt": "2026-01-27T09:23:48.137Z"
  },
  "entities": {
    "SalesEngagementConfig": {
      "purpose": "Stores configuration for connecting Gmail and HubSpot accounts to enable automated sales engagement processing",
      "attributes": {
        "id": {
          "type": "UUID",
          "description": "Unique identifier for the configuration record",
          "constraints": [
            "@id",
            "@default(uuid())"
          ]
        },
        "gmailOwnerEmail": {
          "type": "String",
          "description": "The sales rep's Gmail address that receives inbound emails",
          "constraints": []
        },
        "hubspotOwnerId": {
          "type": "String",
          "description": "The HubSpot user ID that owns the CRM records created by this system",
          "constraints": []
        }
      },
      "relationships": {},
      "businessRules": [
        "Each configuration links one Gmail account to one HubSpot owner",
        "Required for pipeline to function - system queries this on every email"
      ]
    },
    "ConversationThread": {
      "purpose": "Tracks the complete history and state of email conversations with prospects across multiple touchpoints",
      "attributes": {
        "threadId": {
          "type": "String",
          "description": "Gmail thread identifier that groups related emails together",
          "constraints": [
            "@id"
          ]
        },
        "contactIds": {
          "type": "String[]",
          "description": "Array of contact email addresses involved in this conversation",
          "constraints": []
        },
        "companyId": {
          "type": "String",
          "description": "HubSpot company ID if company record exists in CRM",
          "constraints": [
            "@optional"
          ]
        },
        "companyName": {
          "type": "String",
          "description": "Company name extracted from email or retrieved from CRM",
          "constraints": [
            "@optional"
          ]
        },
        "leadStage": {
          "type": "Enum",
          "description": "Current qualification stage of the lead in the sales pipeline",
          "constraints": [
            "@enum(NEW,ENGAGED,QUALIFIED,DISQUALIFIED)",
            "@default(NEW)"
          ]
        },
        "dealId": {
          "type": "String",
          "description": "HubSpot deal ID if qualified opportunity has been created",
          "constraints": [
            "@optional"
          ]
        },
        "dealStage": {
          "type": "Enum",
          "description": "Current stage of the sales deal if one exists",
          "constraints": [
            "@enum(DISCOVERY,MEETING,PROPOSAL,NEGOTIATION,CLOSED_WON,CLOSED_LOST)",
            "@optional"
          ]
        },
        "latestNoteId": {
          "type": "String",
          "description": "Most recent HubSpot engagement note ID for this conversation",
          "constraints": [
            "@optional"
          ]
        },
        "latestTaskId": {
          "type": "String",
          "description": "Most recent HubSpot task ID created for follow-up",
          "constraints": [
            "@optional"
          ]
        },
        "latestMeetingId": {
          "type": "String",
          "description": "Most recent HubSpot meeting ID scheduled with this contact",
          "constraints": [
            "@optional"
          ]
        },
        "lastActivity": {
          "type": "DateTime",
          "description": "Timestamp of the most recent email or activity in this thread",
          "constraints": [
            "@default(now())"
          ]
        },
        "emailCount": {
          "type": "Int",
          "description": "Total number of emails exchanged in this conversation thread",
          "constraints": [
            "@default"
          ]
        },
        "createdAt": {
          "type": "DateTime",
          "description": "When this conversation thread was first created",
          "constraints": [
            "@default(now())"
          ]
        },
        "updatedAt": {
          "type": "DateTime",
          "description": "When this conversation thread was last updated",
          "constraints": [
            "@default(now())"
          ]
        }
      },
      "relationships": {},
      "businessRules": [
        "Thread ID must match Gmail thread identifier exactly",
        "Email count increments with each processed email in the thread",
        "Lead stage can progress forward or regress based on email content",
        "Deal ID is only set when lead reaches QUALIFIED stage with clear opportunity"
      ]
    }
  },
  "events": {
    "enrichLeadContext": {
      "purpose": "Triggers enrichment of lead data by querying existing CRM records and conversation history",
      "parameters": {
        "companyDomain": "String",
        "contactEmail": "String",
        "threadId": "String"
      },
      "public": false,
      "usedBy": [
        "enrichLeadContext",
        "LeadPipelineOrchestrator"
      ]
    },
    "trackConversationState": {
      "purpose": "Updates or creates conversation thread state after CRM synchronization completes",
      "parameters": {
        "threadId": "String",
        "contactEmail": "String",
        "companyId": "String",
        "companyName": "String",
        "leadStage": "String",
        "dealId": "String",
        "dealStage": "String",
        "noteId": "String",
        "taskId": "String",
        "meetingId": "String"
      },
      "public": false,
      "usedBy": [
        "trackConversationState",
        "LeadPipelineOrchestrator"
      ]
    }
  },
  "workflows": {
    "enrichLeadContext": {
      "purpose": "Enriches lead intelligence with existing CRM data and conversation history to provide full context for classification",
      "businessLogic": "Queries HubSpot for existing company and contact records, retrieves conversation thread history, combines all context into single enriched payload",
      "entitiesInvolved": [
        "ConversationThread"
      ],
      "pattern": "data-enrichment-with-external-lookup",
      "steps": [
        "Query HubSpot CRM for existing company by domain and contact by email",
        "Query ConversationThread entity for existing thread state",
        "If thread exists, extract lead stage and email count from history",
        "Combine CRM data and thread state into EnrichedLeadContext",
        "Return enriched context with all existing record IDs and conversation history"
      ],
      "triggerEvent": "enrichLeadContext"
    },
    "trackConversationState": {
      "purpose": "Maintains conversation thread state by updating email count, lead stage, and CRM associations after each processed email",
      "businessLogic": "Updates existing thread or creates new thread, increments email count, updates lead and deal stages, records latest CRM activity IDs",
      "entitiesInvolved": [
        "ConversationThread"
      ],
      "pattern": "upsert-with-counter-increment",
      "steps": [
        "Query for existing ConversationThread by threadId",
        "If thread exists, increment emailCount and update all fields",
        "If thread does not exist, create new thread with emailCount set to 1",
        "Update lastActivity and updatedAt timestamps",
        "Return updated or created ConversationThread record"
      ],
      "triggerEvent": "trackConversationState"
    },
    "bypassLeadProcessing": {
      "purpose": "Handles emails that do not require sales processing by returning rejection record",
      "businessLogic": "Returns QualificationRejection indicating email was skipped",
      "entitiesInvolved": [],
      "pattern": "bypass-with-rejection-reason",
      "steps": [
        "Create QualificationRejection record with skipped flag set to true",
        "Set reason explaining why email does not need processing"
      ],
      "triggerEvent": "None"
    }
  },
  "agents": {
    "EmailQualificationAgent": {
      "role": "Filters incoming emails to identify business opportunities requiring sales engagement while excluding automated messages, newsletters, and spam",
      "type": "analyzer",
      "tools": [],
      "interactionPattern": "Receives InboundEmailPayload and returns EmailQualificationResult with needsProcessing decision",
      "businessValue": "Prevents sales team from wasting time on irrelevant emails while ensuring all genuine opportunities are captured",
      "isPublic": false
    },
    "LeadIntelligenceExtractor": {
      "role": "Extracts structured contact and company information from qualified sales emails including names, roles, company details, and relationship context",
      "type": "analyzer",
      "tools": [],
      "interactionPattern": "Receives EmailQualificationResult and returns LeadIntelligence with parsed contact and company data",
      "businessValue": "Automates data entry by extracting key information from emails and preparing it for CRM synchronization",
      "isPublic": false
    },
    "LeadStageClassifier": {
      "role": "Analyzes lead quality and sales readiness by scoring emails, determining pipeline stages, and recommending next actions based on content and conversation history",
      "type": "analyzer",
      "tools": [],
      "interactionPattern": "Receives LeadIntelligence and EnrichedLeadContext, returns LeadClassificationReport with scoring and recommendations",
      "businessValue": "Prioritizes leads by automatically scoring and staging opportunities, helping sales reps focus on highest-value prospects",
      "isPublic": false
    },
    "LeadPipelineOrchestrator": {
      "role": "Orchestrates the complete end-to-end sales pipeline from email receipt through CRM synchronization and conversation tracking",
      "type": "planner",
      "tools": [],
      "interactionPattern": "Conversational natural language - accepts InboundEmailPayload and executes full pipeline workflow",
      "businessValue": "Automates the entire lead processing workflow, eliminating manual data entry and ensuring consistent CRM hygiene",
      "isPublic": true
    }
  },
  "flows": {
    "LeadPipelineOrchestrator": {
      "purpose": "Orchestrates the complete lead engagement workflow from inbound email to CRM synchronization with full context enrichment and conversation tracking",
      "nodes": [
        "EmailQualificationAgent",
        "shouldProcessLead",
        "bypassLeadProcessing",
        "LeadIntelligenceExtractor",
        "enrichLeadContext",
        "LeadStageClassifier",
        "hubspot/syncLeadToCRM",
        "trackConversationState"
      ],
      "publicAgent": "LeadPipelineOrchestrator",
      "useCase": "Automated sales development representative that processes inbound emails, qualifies leads, extracts contact information, enriches with CRM context, scores opportunities, syncs to HubSpot, and tracks conversation history"
    }
  },
  "designPatterns": [
    "All entities use UUID @id with @default(uuid()) except ConversationThread which uses String threadId to match Gmail threading",
    "Enum constraints used for controlled vocabularies like leadStage, dealStage, category to ensure data consistency",
    "Optional fields marked with @optional for data that may not always be present like companyId or dealId",
    "Default values set with @default for timestamps and counters to ensure fields are never null",
    "Workflow pattern: query existing data, conditional logic for update vs create, return result",
    "Agent instructions follow structured template: INPUT DATA, DECISION LOGIC, STEP-BY-STEP PROCESS, OUTPUT CONSTRUCTION, VALIDATION CHECKLIST",
    "Data preservation: All agents must copy input fields exactly to output, never truncate or modify",
    "Context awareness: Workflows always check for existing records before creating to avoid duplicates",
    "Pipeline orchestration: Flow uses decision node to branch between qualified and unqualified paths"
  ],
  "updateHistory": [],
  "copilotContext": {
    "lastAnalyzedCode": "2025-01-23T10:00:00Z",
    "codeComplexity": "complex",
    "mainUseCases": [
      "Automated email qualification to filter business opportunities from noise",
      "Contact and company intelligence extraction from email content",
      "Lead scoring and pipeline stage classification based on conversation history",
      "Bidirectional CRM synchronization with HubSpot for contacts, companies, deals, notes, tasks",
      "Conversation thread tracking to maintain context across multiple email exchanges"
    ],
    "commonQueries": [
      "Get conversation thread by Gmail threadId to retrieve history",
      "Query ConversationThread by leadStage to find all qualified opportunities",
      "Retrieve SalesEngagementConfig to get Gmail and HubSpot connection settings",
      "Find all threads with emailCount greater than threshold to identify engaged prospects",
      "Query threads by companyId to see all conversations with a specific company"
    ]
  }
}